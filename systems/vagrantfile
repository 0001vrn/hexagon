# -*- mode: ruby -*-
# vi: set ft=ruby :

#
# Disable default shared folder.
#
# WARN: Install Vagrant from HashiCorp's packages, Linux distributions' ones can be broken
#
# For a complete reference, please see the online documentation at: https://docs.vagrantup.com
#
Vagrant.configure(2) do |config|
  hostname = 'hexagon'

  config.vm.box = 'centos_java'
  config.vm.synced_folder '.', '/vagrant', disabled: true
  config.vm.hostname = hostname
  config.vm.network 'private_network', ip: '192.168.0.210'
  config.vm.post_up_message = "<#{hostname}> UP"

  config.vm.provider 'virtualbox' do |vb|
    vb.name = hostname
    vb.cpus = 4
    vb.memory = 1024
    vb.customize ['modifyvm', :id, '--paravirtprovider', 'kvm']
    vb.customize ['modifyvm', :id, '--cpuexecutioncap', '90']
  end

  config.vm.provision :file, source: '../build/libs', destination: '~'
  config.vm.provision :file, source: 'benchmark', destination: '~/benchmark'

  config.vm.provision :docker, images: %w(mongo mysql) do |d|
    d.run 'mongo', image: 'mongo', args: '-p 27017:27017'
    d.run 'mysql', image: 'mysql', args: '-p 3306:3306 -e MYSQL_ALLOW_EMPTY_PASSWORD=yes'
  end
end
