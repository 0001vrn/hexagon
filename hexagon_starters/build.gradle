import java.text.SimpleDateFormat

import static java.lang.System.getenv

apply plugin: 'uk.co.cacoethes.lazybones-templates'

// TODO Write version to template `VERSION` file
// TODO Replace version in template `gradle.properties`
// TODO Include all subdirs as templateDirs
lazybones {
    final String btUser = findProperty ('bintrayUser') ?: getenv('BINTRAY_USER') ?: 'anonymous'
    final String btKey = findProperty ('bintrayKey') ?: getenv('BINTRAY_KEY') ?: 'anonymous'

    repositoryName = "$btUser/maven"
    publish = true

    setRepositoryUsername btUser.toString () ?: 'anonymous'
    setRepositoryApiKey btKey.toString () ?: 'anonymous'

    licenses = [ 'MIT' ]
    setTemplateDirs(files("$buildDir/hexagon-service"))
}

task processTemplate() {
    doLast {
        copy {
            from "$projectDir/hexagon-service"
            into "$buildDir/hexagon-service"
        }

        copy {
            from "$rootDir/gradle/wrapper"
            into "$buildDir/hexagon-service/gradle/wrapper"
        }

        copy {
            from rootDir
            into "$buildDir/hexagon-service"
            include 'gradlew', 'gradlew.bat', '.editorconfig'
        }

        new File("$buildDir/hexagon-service/VERSION").text = rootProject.version
    }
}

packageAllTemplates.dependsOn 'processTemplate'
